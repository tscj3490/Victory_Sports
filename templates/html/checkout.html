{% extends "base.html" %}

{% block header_title %}
    <a href="{{ href('/') }}" class="header-title__link">
        {% if locale == "en-US" or locale == "" %}
            <h1 class="header-title">&nbsp;</h1>
        {% else %}
            <h1 class="header-title header-title--arabic">&nbsp;</h1>                    
        {% endif %}
        <span class="header-title__subtitle">{{ t("pages.shop.header_title") }}</span>
    </a>
{% endblock %}

{% block below_header_buttons %}
    <div class="header__background">
        <div class="header__row--secondary">
            <a href="{{ href('/shop/any/') }}" class="header__link">{{ t("pages.shop.title") }}</a>
            <a href="{{ href('/stats/') }}" class="header__link">{{ t("pages.stats.title") }}</a>
        </div>
    </div>
{% endblock %}

{% block top_leader %}
{% endblock %}

{% block extend_javascript %}
    <script src="/public/static/vendor/jquery-validation-1.17.0/dist/jquery.validate.min.js" crossorigin="anonymous"></script>
    {#<script src="/public/static/vendor/jquery-validation-1.17.0/dist/localization/messages_ar.min.js" crossorigin="anonymous"></script>#}
    <script language="JavaScript">
        $("#checkout-form").validate();

        jQuery.validator.addMethod("email", function(value, element) {
            return this.optional( element ) || /^([a-zA-Z0-9_.+-])+\@(([a-zA-Z0-9-])+\.)+([a-zA-Z0-9]{2,6})$/.test( value );
        }, 'Please enter a valid email address.');

        $('input[name="Delivery"]').on("change", function(){
            $('button[value="saveDelivery"]').click();
        });
    </script>
{% endblock %}

{% block content %}
    <form method="post" action="./process" id="checkout-form">
        <div class="background background--checkout main-container">
            <div class="checkout">
                <div class="checkout__main-content">
                    <h4 class="heading--checkout" data-minimized="checkout__block--shipment" data-button-minimized="button-row--checkout">{{ t("pages.checkout.shipment") }}</h4>
                    <div class="checkout__block checkout__block--shipment">
                        <div class="checkout__shipment-column">
                            <div class="form-row">
                                <label for="inputContactName" class="col-sm-3 col-form-label">{{ t("pages.checkout.name") }}</label>
                                <div class="col-sm-7">
                                    <input value="{{ cd.ContactName }}" name="ContactName" type="tel" required="" aria-required="true" class="form-control" id="inputContactName" placeholder="{{ t('pages.checkout.namePlaceholder')}}">
                                </div>
                            </div>
                            <div class="form-row">
                                <label for="inputTelephone" class="col-sm-3 col-form-label">{{ t("pages.checkout.telephone") }}</label>
                                <div class="col-sm-7">
                                    <input value="{{ cd.Telephone }}" name="Telephone" type="tel" required="" aria-required="true" class="form-control" id="inputTelephone" placeholder="+971 50 2246461">
                                </div>
                            </div>
                            <div class="form-row">
                                <label for="inputEmail3" class="col-sm-3 col-form-label">{{ t("pages.checkout.email") }}</label>
                                <div class="col-sm-7">
                                    <input value="{{ cd.Email }}" name="Email" type="email" required="" aria-required="true" class="form-control" id="inputEmail3" placeholder="hello@example.com">
                                </div>
                            </div>
                            <div class="form-row">
                                <label for="inputAdd1" class="col-sm-3 col-form-label">{{ t("pages.checkout.addressLine1") }}</label>
                                <div class="col-sm-7">
                                    <input value="{{ cd.AddressLine1 }}" name="AddressLine1" type="text" required="" aria-required="true" class="form-control" id="inputAdd1" placeholder="{{ t('pages.checkout.addressLine1Placeholder')}}">
                                </div>
                            </div>
                            <div class="form-row">
                                <label for="inputAdd2" class="col-sm-3 col-form-label">{{ t("pages.checkout.addressLine2") }}</label>
                                <div class="col-sm-7">
                                    <input value="{{ cd.AddressLine2 }}" name="AddressLine2" type="text" required="" aria-required="true" class="form-control" id="inputAdd2" placeholder="{{ t('pages.checkout.addressLine2Placeholder')}}">
                                </div>
                            </div>
                        </div>
                        <div class="checkout__shipment-column">
                            <div class="form-row">
                                <label for="inputPostalCode" class="col-sm-3 col-form-label">{{ t("pages.checkout.postalCode") }}</label>
                                <div class="col-sm-7">
                                    <input value="{{ cd.PostalCode }}" name="PostalCode" type="text" required="" aria-required="true" class="form-control" id="inputPostalCode" placeholder="0000">
                                </div>
                            </div>
                            <div class="form-row">
                                <label for="inputCity" class="col-sm-3 col-form-label">{{ t("pages.checkout.city") }}</label>
                                <div class="col-sm-7">
                                    <input value="{{ cd.City }}" name="City" type="text" required="" aria-required="true" class="form-control" id="inputCity" placeholder="{{ t('pages.checkout.cityPlaceholder')}}">
                                </div>
                            </div>
                            <div class="form-row">
                                <label for="selectCountry" class="col-sm-3 col-form-label">{{ t("pages.checkout.country") }}</label>
                                <div class="col-sm-7">
                                    <select required="" aria-required="true" class="form-control" id="selectCountry" name="Country">
                                        <option value="">{{ t("pages.checkout.selectACountry") }}</option>
                                        {% for c, country in countries sorted %}
                                            <option {% if cd.Country == c %}selected{% endif %}
                                                    value="{{ c }}">{{ country.ISO3166OneEnglishShortNameGazetteerOrder }}</option>
                                        {% endfor  %}
                                    </select>
                                </div>
                            </div>
                            <div class="form-row">
                                <label for="inputNotes" class="col-sm-3 col-form-label">{{ t("pages.checkout.notes") }}</label>
                                <div class="col-sm-7">
                                    <input value="{{ cd.Notes }}" name="Notes" type="text" class="form-control" id="inputNotes" placeholder="{{ t('pages.checkout.notesPlaceholder') }}">
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="button-row button-row--checkout button-row--shipment">
                        <button class="button button--checkout" name="Action" value="saveShipping">{{ t("pages.checkout.saveChanges") }}</button>
                    </div>
                    <h4 class="heading--checkout" data-minimized="checkout__block--delivery" data-button-minimized="button-row--delivery">{{ t("pages.checkout.delivery") }}</h4>
                    <div class="checkout__block checkout__block--delivery">
                        <input  {% if cd.Delivery == "" or cd.Delivery == "standardDelivery" %}checked{% endif %}
                                class="checkout__radio-button" type="radio" name="Delivery" id="standardDelivery" value="standardDelivery">
                        <label class="checkout__delivery-label" for="standardDelivery">{{ t("pages.checkout.delivery") }}</label>
                        <small id="deliveryHelpText" class="checkout__delivery-small">{{ t("pages.checkout.regularDeliveryDescription") }}</small>
                        <input {% if cd.Delivery == "expressDelivery" %}checked{% endif %}
                                class="checkout__radio-button" type="radio" name="Delivery" id="expressDelivery" value="expressDelivery">
                        <label class="checkout__delivery-label" for="expressDelivery">{{ t("pages.checkout.expressDelivery") }}</label>
                        <small id="expressDeliveryHelpText" class="checkout__delivery-small">{{ t("pages.checkout.expressDeliveryDescription", DeliveryChargesExpress) }}</small>
                    </div>
                    <div class="button-row button-row--checkout button-row--delivery">
                        <button class="button button--checkout" value="saveDelivery" name="Action">{{ t("pages.checkout.saveChanges") }}</button>
                    </div>
                    <h4 class="heading--checkout" data-minimized="checkout__block--payment" data-button-minimized="button-row--payment">{{ t("pages.checkout.payment") }}</h4>
                    <div class="checkout__block checkout__block--payment">
                    <!-- all payment options -->
                        <div class="checkout__radio-row">
                            {#<input class="checkout__radio-button" type="checkbox" id="cashOnDelivery" value="option1">#}
                            {#<label for="cashOnDelivery">Cash On Delivery</label>#}
                            <input disabled required="" aria-required="true" class="checkout__radio-button" type="radio" name="Payment" id="cashOnDelivery" value="cashOnDelivery">
                            <label for="cashOnDelivery">
                                {{ t("pages.checkout.cashOnDelivery") }} <span class="checkout__unavailable">({{ t("pages.checkout.currentlyUnavailable") }})</span>
                            </label>
                            {#<small id="expressDeliveryHelpText" class="text-muted"></small>#}
                        </div>
                        <div class="checkout__radio-row">
                            {#<input class="checkout__radio-button" type="checkbox" id="creditCard" value="option2">#}
                            {#<label for="creditCard">Credit Card</label>#}
                            <input checked required="" aria-required="true" class="checkout__radio-button" type="radio" name="Payment" id="creditCard" value="creditCard">
                            <label for="creditCard">{{ t("pages.checkout.creditCard") }}</label>
                        </div>
                        <div class="checkout__radio-row">
                            {#<input class="checkout__radio-button" type="checkbox" id="payWithPaypal" value="option2">#}
                            {#<label for="payWithPaypal">Pay With PayPal</label>#}
                            <input disabled required="" aria-required="true" class="checkout__radio-button" type="radio" name="Payment" id="payWithPayPal" value="paypal">
                            <label for="payWithPayPal">
                                {{ t("pages.checkout.payWithPaypal") }} <span class="checkout__unavailable">({{ t("pages.checkout.currentlyUnavailable") }})</span>
                            </label>
                        </div>
                    <!-- redirect to the payment provider -->
                    </div>
                    <div class="checkout__block checkout__block--terms">
                        <input class="checkout__checkbox" type="checkbox" name="Terms" id="acceptTerms" value="termsAccepted" checked required aria-required="true">
                        <label for="acceptTerms">{{ t("pages.checkout.readAndAcceptTerms", "/terms") }}</label>
                        {#<small id="acceptTermsHelpText" class="text-muted">Hello</small>#}
                    </div>
                    <div class="checkout__block">
                        <dl class="checkout__summary">
                            <dt class="checkout__summary-term">{{ t("pages.checkout.subtotal") }}</dt>
                            <dd class="checkout__summary-value">{{ t("currency.aed_x", subtotal|floatformat:"2") }}</dd>
                            <dt class="checkout__summary-term">{{ t("pages.checkout.vat") }}</dt>
                            <dd class="checkout__summary-value">{{ t("currency.aed_x", vat|floatformat:"2") }}</dd>
                            <dt class="checkout__summary-term">{{ t("pages.checkout.shipment") }}</dt>
                            {% if shipping == 0.0 %}
                                <dd class="checkout__summary-value">{{ t("pages.checkout.free") }}</dd>
                            {% else %}
                                <dd class="checkout__summary-value">{{ t("currency.aed_x", shipping|floatformat:"2") }}</dd>
                            {% endif %}
                            <hr class="checkout__summary-divider">
                            <dt class="checkout__summary-term checkout__summary-term--total">{{ t("pages.checkout.total") }}</dt>
                            <dd class="checkout__summary-value checkout__summary-value--total">{{ t("currency.aed_x", total|floatformat:"2") }}</dd>
                        </dl>
                    </div>
                    <div class="button-row button-row--checkout">
                        <button class="button button--checkout" value="order" name="Action">{{ t("pages.checkout.submit") }}</button>
                    </div>
                </div>
                <div class="checkout__secondary-content">
                    <div class="flex-container flex-container--order">
                        <h4 class="heading--checkout-secondary">{{ t("pages.checkout.yourOrder") }}</h4>
                        <a href="{{ href('/cart/') }}" class="checkout__edit-order">Edit order</a>
                    </div>
                    <div class="checkout__block">
                        {% for productVariation in selectedProductVariations %}
                        {% with product=productVariation.Product %}
                            <!-- one order item -->
                            <div class="row checkout__order-item">
                                <div class="col-auto">
                                    {% if product.Thumbnail %}
                                        <img src="{{ product.Thumbnail }}" alt="{{ product.Name }}">
                                    {% else %}
                                        <img src="/public/static/img/1x/main_picture-100.jpg" alt="main image">
                                    {% endif %}
                                </div>
                                <div class="col-5">
                                    <h6 style="color: #4d4d4d; font-weight: 700;">{{ product.Name }}</h6>
                                    <p>
                                        <span>Size: {{ productVariation.Size.Name }}</span><br>
                                        {% for id, item in cartItems %}
                                            {% if id==productVariation.ID %}
                                                <span>Quantity: {{ item.Quantity }}</span>
                                            {% endif %}
                                        {% endfor %}
                                        {% if productVariation.BadgeID %}
                                            <br><span>{{ t("pages.checkout.badge", productVariation.Badge.Name) }}</span>
                                        {% endif %}
                                    </p>
                                </div>
                            </div>
                        <!-- /one order item -->
                        {% endwith %}
                        {% endfor %}
                        <dl class="checkout__summary checkout__summary--secondary checkout__summary--no-border">
                            <dt class="checkout__summary-term">{{ t("pages.checkout.subtotal") }}</dt>
                            <dd class="checkout__summary-value">{{ t("currency.aed_x", subtotal|floatformat:"2") }}</dd>
                            <dt class="checkout__summary-term">{{ t("pages.checkout.vat") }}</dt>
                            <dd class="checkout__summary-value">{{ t("currency.aed_x", vat|floatformat:"2") }}</dd>
                            <dt class="checkout__summary-term">{{ t("pages.checkout.shipment") }}</dt>
                            {% if shipping == 0.0 %}
                                <dd class="checkout__summary-value">{{ t("pages.checkout.free") }}</dd>
                            {% else %}
                                <dd class="checkout__summary-value">{{ t("currency.aed_x", shipping|floatformat:"2") }}</dd>
                            {% endif %}
                            <hr class="checkout__summary-divider">
                            <dt class="checkout__summary-term checkout__summary-term--total">{{ t("pages.checkout.total") }}</dt>
                            <dd class="checkout__summary-value checkout__summary-value--total">{{ t("currency.aed_x", total|floatformat:"2") }}</dd>
                        </dl>
                    </div>
                </div>
            </div>
        </div>
    </form>

    <script>
        (function() {
            $(".heading--checkout").on('click', function(e) {
                var that = $(this);
                var target = that.attr('data-minimized');
                if (target === "") {
                    return;
                }
                $('.'+target).fadeToggle( "fast", function() {
                    // nothing to do after
                    // toggle the minimized class so that the + and - icon change
                    that.toggleClass('heading--minimised-checkout');                    
                });
                var target = that.attr('data-button-minimized')
                $('.'+target).fadeToggle( "fast", function() {
                    // nothing to do after
                });
            });
        })();
    </script>
{% endblock %}
